{"ast":null,"code":"var _jsxFileName = \"/Users/leonslaptop/Desktop/GSoC/Hanliang-Xu.github.io/frontend/src/pages/JSONUpload.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport { Box, Button, Typography } from '@mui/material';\n\n//const API_BASE_URL = 'https://asl-parameters-generator-a94b4af439d2.herokuapp.com/';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_BASE_URL = 'http://127.0.0.1:8000';\n\n//const API_BASE_URL = 'https://rock-sublime-428805-r3.uc.r.appspot.com';\n\nfunction JSONUpload() {\n  _s();\n  const [majorErrorReport, setMajorErrorReport] = useState(null);\n  const [majorErrorReportConcise, setMajorErrorReportConcise] = useState(null);\n  const [majorErrorReportConciseText, setMajorErrorReportConciseText] = useState(null);\n  const [errorReport, setErrorReport] = useState(null);\n  const [errorReportConcise, setErrorReportConcise] = useState(null);\n  const [errorReportConciseText, setErrorReportConciseText] = useState(null);\n  const [warningReport, setWarningReport] = useState(null);\n  const [warningReportConcise, setWarningReportConcise] = useState(null);\n  const [warningReportConciseText, setWarningReportConciseText] = useState(null);\n  const [report, setReport] = useState(null);\n  const [extendedReport, setExtendedReport] = useState(null);\n  const [uploadError, setUploadError] = useState(null);\n  const [inconsistencies, setInconsistencies] = useState(null);\n  const [majorInconsistencies, setMajorInconsistencies] = useState(null);\n  const [warningInconsistencies, setWarningInconsistencies] = useState(null);\n  const [showMajorConcise, setShowMajorConcise] = useState(true);\n  const [showErrorConcise, setShowErrorConcise] = useState(true);\n  const [showWarningConcise, setShowWarningConcise] = useState(true);\n  const [copySuccess, setCopySuccess] = useState('');\n  const handleDirectoryUpload = async event => {\n    const files = Array.from(event.target.files);\n\n    // Function to find relevant JSON and TSV files\n    const findRelevantFiles = items => {\n      const relevantFiles = [];\n\n      // Helper function to find file by name in the given folder\n      const findFileInFolder = (folderItems, fileName) => {\n        return folderItems.find(item => item.name.endsWith(fileName));\n      };\n      for (const item of items) {\n        const relativePath = item.webkitRelativePath || item.relativePath;\n        const pathParts = relativePath.split('/');\n        const parentFolder = pathParts[pathParts.length - 2];\n        if (parentFolder === 'perf' && item.name.endsWith('asl.json')) {\n          relevantFiles.push(item);\n          // Extract the base name before '_asl.json'\n          const baseName = item.name.replace('_asl.json', '');\n\n          // Find related files in the same folder\n          const folderItems = items.filter(i => i.webkitRelativePath.startsWith(relativePath.replace(/[^/]+$/, '')));\n\n          // Check if the base name matches the '_run-*' pattern\n          const runPatternMatch = baseName.match(/_run-\\d+$/);\n          if (runPatternMatch) {\n            const m0scanFile = findFileInFolder(folderItems, `${baseName}_m0scan.json`);\n            const aslcontextFile = findFileInFolder(folderItems, `${baseName}_aslcontext.tsv`);\n            if (m0scanFile) {\n              relevantFiles.push(m0scanFile); // Push _run-*_m0scan.json if it exists\n            }\n            if (aslcontextFile) {\n              relevantFiles.push(aslcontextFile); // Push _run-*_aslcontext.tsv if it exists\n            }\n          } else {\n            const m0scanFile = findFileInFolder(folderItems, 'm0scan.json');\n            const aslcontextFile = findFileInFolder(folderItems, 'aslcontext.tsv');\n            if (m0scanFile) {\n              relevantFiles.push(m0scanFile); // Push m0scan.json if it exists\n            }\n            if (aslcontextFile) {\n              relevantFiles.push(aslcontextFile); // Push aslcontext.tsv if it exists\n            }\n          }\n        }\n      }\n      return relevantFiles;\n    };\n\n    // Function to find the .nii or .nii.gz file in the perf folder\n    const findNiiFile = items => {\n      for (const item of items) {\n        const relativePath = item.webkitRelativePath || item.relativePath;\n        const pathParts = relativePath.split('/');\n        const parentFolder = pathParts[pathParts.length - 2];\n        if (parentFolder === 'perf' && (item.name.endsWith('asl.nii.gz') || item.name.endsWith('asl.nii'))) {\n          return item; // Return the first found .nii.gz or .nii file\n        }\n      }\n      return null;\n    };\n\n    // Main logic\n    const niiFile = findNiiFile(files);\n    const relevantFiles = findRelevantFiles(files);\n    const formData = new FormData();\n    formData.append('nii-file', niiFile);\n\n    // Append all relevant files to formData\n    files.forEach(file => {\n      if (file.name.endsWith('.dcm')) {\n        formData.append('dcm-files', file);\n      }\n    });\n    relevantFiles.forEach(file => {\n      formData.append('files', file);\n      formData.append('filenames', file.name);\n    });\n    try {\n      const response = await fetch(`${API_BASE_URL}/upload`, {\n        method: 'POST',\n        body: formData\n      });\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`Server error: ${response.status} - ${errorText}`);\n      }\n      const result = await response.json();\n      setMajorErrorReport(Object.keys(result.major_errors).length ? result.major_errors : null);\n      setMajorErrorReportConcise(Object.keys(result.major_errors_concise).length ? result.major_errors_concise : null);\n      setMajorErrorReportConciseText(result.major_errors_concise_text || null);\n      setErrorReport(Object.keys(result.errors).length ? result.errors : null);\n      setErrorReportConcise(Object.keys(result.errors_concise).length ? result.errors_concise : null);\n      setErrorReportConciseText(result.errors_concise_text || null);\n      setWarningReport(Object.keys(result.warnings).length ? result.warnings : null);\n      setWarningReportConcise(Object.keys(result.warnings_concise).length ? result.warnings_concise : null);\n      setWarningReportConciseText(result.warnings_concise_text || null);\n      setReport(result.report || null);\n      setInconsistencies(result.inconsistencies || null);\n      setMajorInconsistencies(result.major_inconsistencies || null);\n      setWarningInconsistencies(result.warning_inconsistencies || null);\n      setUploadError(null);\n    } catch (error) {\n      console.error('Error:', error);\n      setUploadError(error.message);\n    }\n  };\n  const handleDownloadReport = type => {\n    window.location.href = `${API_BASE_URL}/download?type=${type}`;\n  };\n  const renderReportSection = (title, fullReport, conciseReport, conciseText, showConcise, setShowConcise, type) => /*#__PURE__*/_jsxDEV(Box, {\n    mt: 2,\n    sx: {\n      border: `1px solid ${type === 'major_errors' ? 'darkred' : type === 'errors' ? 'red' : 'orange'}`,\n      padding: '10px',\n      borderRadius: '8px',\n      backgroundColor: type === 'major_errors' ? '#ffe6e6' : type === 'errors' ? '#ffe6e6' : '#fff4e6'\n    },\n    children: [/*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h6\",\n      sx: {\n        color: type === 'major_errors' ? 'darkred' : type === 'errors' ? 'red' : 'orange'\n      },\n      children: [title, \":\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 13\n    }, this), showConcise && /*#__PURE__*/_jsxDEV(Box, {\n      mt: 2,\n      children: /*#__PURE__*/_jsxDEV(\"pre\", {\n        style: {\n          whiteSpace: 'pre-wrap',\n          wordWrap: 'break-word'\n        },\n        children: type === 'major_errors' ? majorInconsistencies : type === 'errors' ? inconsistencies : type === 'warnings' ? warningInconsistencies : ''\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n      style: {\n        whiteSpace: 'pre-wrap',\n        wordWrap: 'break-word'\n      },\n      children: showConcise ? conciseText ? conciseText : conciseReport ? JSON.stringify(conciseReport, null, 2) : \"\" : fullReport ? JSON.stringify(fullReport, null, 2) : \"\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      variant: \"contained\",\n      color: \"error\",\n      onClick: () => handleDownloadReport(type),\n      children: [\"Download \", type.replace('_', ' '), \" Report\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      variant: \"contained\",\n      color: \"secondary\",\n      onClick: () => setShowConcise(!showConcise),\n      children: showConcise ? \"Show Full Report\" : \"Show Concise Report\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 161,\n    columnNumber: 9\n  }, this);\n  const copyToClipboard = () => {\n    navigator.clipboard.writeText(report).then(() => {\n      setCopySuccess('Report copied to clipboard!');\n      setTimeout(() => setCopySuccess(''), 2000); // Clear the success message after 2 seconds\n    }).catch(err => {\n      setCopySuccess('Failed to copy!');\n      console.error('Failed to copy: ', err);\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    my: 4,\n    sx: {\n      width: '80%',\n      margin: '0 auto',\n      padding: '20px',\n      border: '1px solid #ccc',\n      borderRadius: '8px',\n      backgroundColor: '#f9f9f9',\n      marginTop: '40px'\n    },\n    children: [/*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h4\",\n      gutterBottom: true,\n      children: \"Select a BIDS Folder to Generate a Parameter Report\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      mt: 4,\n      p: 2,\n      sx: {\n        border: '1px solid #ccc',\n        borderRadius: '8px',\n        backgroundColor: '#f1f1f1'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h5\",\n        children: \"User Manual\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body1\",\n        mt: 2,\n        children: \"This application allows you to generate an ASL parameter report to be copied into the Methods section of paper. The program will validate the ASL datasets by checking for inconsistencies, invalid values, and providing warnings for slight variations. Please ensure that your dataset is organized according to the BIDS standard before uploading. Here are some sample folders for you to download and test: https://drive.google.com/drive/folders/1NuG_ofLbaLYswNlBN2aRDkxLOucYFQfg?usp=sharing\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body1\",\n        mt: 2,\n        children: /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Steps:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body1\",\n        mt: 1,\n        children: \"1. Click the \\\"Choose Folder\\\" button and select the BIDS folder containing your ASL data.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body1\",\n        mt: 1,\n        children: \"2. The application will process your files (including xxx_asl.json and xxx_asl.nii or xxx_asl.nii.gz) and display the results below.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body1\",\n        mt: 1,\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Note:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 21\n        }, this), \" The following specific checks and summaries will be reported:\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body2\",\n        mt: 1,\n        children: [\"- \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Inconsistency Check:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 23\n        }, this), \" Discrepancies between values across different sessions, such as variations in PLD, labeling duration, echo time, and voxel sizes.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body2\",\n        mt: 1,\n        children: [\"- \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Invalid Values Check:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 23\n        }, this), \" Identifying values that do not meet predefined criteria, such as incorrect numeric ranges, boolean values, and string values.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body2\",\n        mt: 1,\n        children: [\"- \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Slight Variation Warning:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 23\n        }, this), \" Highlighting values that might not constitute a major error but are worth noting.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body2\",\n        mt: 1,\n        children: [\"- \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Generated Report:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 23\n        }, this), \" The software generates an ASL parameter report to be included in the Methods section of paper. A suggested statement for inclusion in the cover letter explaining that the relevant part of the Methods section has been constructed according to standard format is also provided (TODO).\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"file\",\n      webkitdirectory: \"true\",\n      onChange: handleDirectoryUpload,\n      style: {\n        margin: '20px 0'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 13\n    }, this), uploadError && /*#__PURE__*/_jsxDEV(Box, {\n      mt: 2,\n      sx: {\n        color: 'red'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        children: \"Upload Error:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n        children: uploadError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 17\n    }, this), majorErrorReport && renderReportSection(\"MAJOR ERRORS (you cannot report a sequence protocol without these)\", majorErrorReport, majorErrorReportConcise, majorErrorReportConciseText, showMajorConcise, setShowMajorConcise, 'major_errors'), errorReport && renderReportSection(\"ERRORS (these are major shortcomings, you need to provide those)\", errorReport, errorReportConcise, errorReportConciseText, showErrorConcise, setShowErrorConcise, 'errors'), warningReport && renderReportSection(\"WARNINGS\", warningReport, warningReportConcise, warningReportConciseText, showWarningConcise, setShowWarningConcise, 'warnings'), report && /*#__PURE__*/_jsxDEV(Box, {\n      mt: 2,\n      sx: {\n        border: '1px solid blue',\n        padding: '10px',\n        borderRadius: '8px',\n        backgroundColor: '#e6f7ff',\n        maxHeight: '400px',\n        overflowY: 'auto',\n        position: 'relative' // Add relative positioning for positioning the copy feedback\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        sx: {\n          color: 'blue'\n        },\n        children: \"Generated Report:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n        style: {\n          whiteSpace: 'pre-wrap',\n          wordWrap: 'break-word'\n        },\n        children: report\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        onClick: () => handleDownloadReport('report'),\n        children: \"Download Report\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        color: \"secondary\",\n        onClick: copyToClipboard,\n        sx: {\n          ml: 2\n        },\n        children: \"Copy Report\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 21\n      }, this), copySuccess && /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"subtitle1\",\n        sx: {\n          color: 'green',\n          position: 'absolute',\n          // Position the feedback message absolutely\n          top: 0,\n          right: 0,\n          mt: 1,\n          mr: 1,\n          backgroundColor: 'rgba(255, 255, 255, 0.8)',\n          padding: '5px',\n          borderRadius: '4px'\n        },\n        children: copySuccess\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 25\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 17\n    }, this), extendedReport && /*#__PURE__*/_jsxDEV(Box, {\n      mt: 2,\n      sx: {\n        border: '1px solid green',\n        padding: '10px',\n        borderRadius: '8px',\n        backgroundColor: '#e6ffe6',\n        maxHeight: '400px',\n        overflowY: 'auto',\n        position: 'relative' // Add relative positioning for positioning the copy feedback\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        sx: {\n          color: 'green'\n        },\n        children: \"Extended Report:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 359,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n        style: {\n          whiteSpace: 'pre-wrap',\n          wordWrap: 'break-word'\n        },\n        children: extendedReport\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 360,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        onClick: () => handleDownloadReport('extended_report'),\n        children: \"Download Extended Report\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 364,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 206,\n    columnNumber: 9\n  }, this);\n}\n_s(JSONUpload, \"1kqCtZF3Zy19fty4L1mLK93kkj8=\");\n_c = JSONUpload;\nexport default JSONUpload;\nvar _c;\n$RefreshReg$(_c, \"JSONUpload\");","map":{"version":3,"names":["React","useState","Box","Button","Typography","jsxDEV","_jsxDEV","API_BASE_URL","JSONUpload","_s","majorErrorReport","setMajorErrorReport","majorErrorReportConcise","setMajorErrorReportConcise","majorErrorReportConciseText","setMajorErrorReportConciseText","errorReport","setErrorReport","errorReportConcise","setErrorReportConcise","errorReportConciseText","setErrorReportConciseText","warningReport","setWarningReport","warningReportConcise","setWarningReportConcise","warningReportConciseText","setWarningReportConciseText","report","setReport","extendedReport","setExtendedReport","uploadError","setUploadError","inconsistencies","setInconsistencies","majorInconsistencies","setMajorInconsistencies","warningInconsistencies","setWarningInconsistencies","showMajorConcise","setShowMajorConcise","showErrorConcise","setShowErrorConcise","showWarningConcise","setShowWarningConcise","copySuccess","setCopySuccess","handleDirectoryUpload","event","files","Array","from","target","findRelevantFiles","items","relevantFiles","findFileInFolder","folderItems","fileName","find","item","name","endsWith","relativePath","webkitRelativePath","pathParts","split","parentFolder","length","push","baseName","replace","filter","i","startsWith","runPatternMatch","match","m0scanFile","aslcontextFile","findNiiFile","niiFile","formData","FormData","append","forEach","file","response","fetch","method","body","ok","errorText","text","Error","status","result","json","Object","keys","major_errors","major_errors_concise","major_errors_concise_text","errors","errors_concise","errors_concise_text","warnings","warnings_concise","warnings_concise_text","major_inconsistencies","warning_inconsistencies","error","console","message","handleDownloadReport","type","window","location","href","renderReportSection","title","fullReport","conciseReport","conciseText","showConcise","setShowConcise","mt","sx","border","padding","borderRadius","backgroundColor","children","variant","color","_jsxFileName","lineNumber","columnNumber","style","whiteSpace","wordWrap","JSON","stringify","onClick","copyToClipboard","navigator","clipboard","writeText","then","setTimeout","catch","err","my","width","margin","marginTop","gutterBottom","p","webkitdirectory","onChange","maxHeight","overflowY","position","ml","top","right","mr","_c","$RefreshReg$"],"sources":["/Users/leonslaptop/Desktop/GSoC/Hanliang-Xu.github.io/frontend/src/pages/JSONUpload.js"],"sourcesContent":["import React, {useState} from 'react';\nimport {Box, Button, Typography} from '@mui/material';\n\n//const API_BASE_URL = 'https://asl-parameters-generator-a94b4af439d2.herokuapp.com/';\nconst API_BASE_URL = 'http://127.0.0.1:8000';\n\n//const API_BASE_URL = 'https://rock-sublime-428805-r3.uc.r.appspot.com';\n\nfunction JSONUpload() {\n    const [majorErrorReport, setMajorErrorReport] = useState(null);\n    const [majorErrorReportConcise, setMajorErrorReportConcise] = useState(null);\n    const [majorErrorReportConciseText, setMajorErrorReportConciseText] = useState(null);\n    const [errorReport, setErrorReport] = useState(null);\n    const [errorReportConcise, setErrorReportConcise] = useState(null);\n    const [errorReportConciseText, setErrorReportConciseText] = useState(null);\n    const [warningReport, setWarningReport] = useState(null);\n    const [warningReportConcise, setWarningReportConcise] = useState(null);\n    const [warningReportConciseText, setWarningReportConciseText] = useState(null);\n    const [report, setReport] = useState(null);\n    const [extendedReport, setExtendedReport] = useState(null);\n    const [uploadError, setUploadError] = useState(null);\n    const [inconsistencies, setInconsistencies] = useState(null);\n    const [majorInconsistencies, setMajorInconsistencies] = useState(null);\n    const [warningInconsistencies, setWarningInconsistencies] = useState(null);\n\n    const [showMajorConcise, setShowMajorConcise] = useState(true);\n    const [showErrorConcise, setShowErrorConcise] = useState(true);\n    const [showWarningConcise, setShowWarningConcise] = useState(true);\n    const [copySuccess, setCopySuccess] = useState('');\n\n\n    const handleDirectoryUpload = async (event) => {\n        const files = Array.from(event.target.files);\n\n\n        // Function to find relevant JSON and TSV files\n        const findRelevantFiles = (items) => {\n            const relevantFiles = [];\n\n            // Helper function to find file by name in the given folder\n            const findFileInFolder = (folderItems, fileName) => {\n                return folderItems.find(item => item.name.endsWith(fileName));\n            };\n\n            for (const item of items) {\n                const relativePath = item.webkitRelativePath || item.relativePath;\n                const pathParts = relativePath.split('/');\n                const parentFolder = pathParts[pathParts.length - 2];\n\n                if (parentFolder === 'perf' && item.name.endsWith('asl.json')) {\n                    relevantFiles.push(item);\n                    // Extract the base name before '_asl.json'\n                    const baseName = item.name.replace('_asl.json', '');\n\n                    // Find related files in the same folder\n                    const folderItems = items.filter(i => i.webkitRelativePath.startsWith(relativePath.replace(/[^/]+$/, '')));\n\n                    // Check if the base name matches the '_run-*' pattern\n                    const runPatternMatch = baseName.match(/_run-\\d+$/);\n\n                    if (runPatternMatch) {\n                        const m0scanFile = findFileInFolder(folderItems, `${baseName}_m0scan.json`);\n                        const aslcontextFile = findFileInFolder(folderItems, `${baseName}_aslcontext.tsv`);\n\n                        if (m0scanFile) {\n                            relevantFiles.push(m0scanFile); // Push _run-*_m0scan.json if it exists\n                        }\n                        if (aslcontextFile) {\n                            relevantFiles.push(aslcontextFile); // Push _run-*_aslcontext.tsv if it exists\n                        }\n\n                    } else {\n                        const m0scanFile = findFileInFolder(folderItems, 'm0scan.json');\n                        const aslcontextFile = findFileInFolder(folderItems, 'aslcontext.tsv');\n\n                        if (m0scanFile) {\n                            relevantFiles.push(m0scanFile); // Push m0scan.json if it exists\n                        }\n                        if (aslcontextFile) {\n                            relevantFiles.push(aslcontextFile); // Push aslcontext.tsv if it exists\n                        }\n                    }\n                }\n            }\n\n            return relevantFiles;\n        };\n\n        // Function to find the .nii or .nii.gz file in the perf folder\n        const findNiiFile = (items) => {\n            for (const item of items) {\n                const relativePath = item.webkitRelativePath || item.relativePath;\n                const pathParts = relativePath.split('/');\n                const parentFolder = pathParts[pathParts.length - 2];\n\n                if (parentFolder === 'perf' &&\n                    (item.name.endsWith('asl.nii.gz') || item.name.endsWith('asl.nii'))) {\n                    return item; // Return the first found .nii.gz or .nii file\n                }\n            }\n            return null;\n        };\n\n        // Main logic\n        const niiFile = findNiiFile(files);\n\n        const relevantFiles = findRelevantFiles(files);\n        const formData = new FormData();\n        formData.append('nii-file', niiFile);\n\n        // Append all relevant files to formData\n        files.forEach(file => {\n            if (file.name.endsWith('.dcm')) {\n                formData.append('dcm-files', file);\n            }\n        });\n\n        relevantFiles.forEach(file => {\n            formData.append('files', file);\n            formData.append('filenames', file.name);\n        })\n\n\n        try {\n            const response = await fetch(`${API_BASE_URL}/upload`, {\n                method: 'POST',\n                body: formData\n            });\n\n            if (!response.ok) {\n                const errorText = await response.text();\n                throw new Error(`Server error: ${response.status} - ${errorText}`);\n            }\n\n            const result = await response.json();\n            setMajorErrorReport(Object.keys(result.major_errors).length ? result.major_errors : null);\n            setMajorErrorReportConcise(Object.keys(result.major_errors_concise).length ? result.major_errors_concise : null);\n            setMajorErrorReportConciseText(result.major_errors_concise_text || null);\n            setErrorReport(Object.keys(result.errors).length ? result.errors : null);\n            setErrorReportConcise(Object.keys(result.errors_concise).length ? result.errors_concise : null);\n            setErrorReportConciseText(result.errors_concise_text || null);\n            setWarningReport(Object.keys(result.warnings).length ? result.warnings : null);\n            setWarningReportConcise(Object.keys(result.warnings_concise).length ? result.warnings_concise : null);\n            setWarningReportConciseText(result.warnings_concise_text || null);\n            setReport(result.report || null);\n            setInconsistencies(result.inconsistencies || null);\n            setMajorInconsistencies(result.major_inconsistencies || null);\n            setWarningInconsistencies(result.warning_inconsistencies || null);\n            setUploadError(null);\n        } catch (error) {\n            console.error('Error:', error);\n            setUploadError(error.message);\n        }\n    };\n\n    const handleDownloadReport = (type) => {\n        window.location.href = `${API_BASE_URL}/download?type=${type}`;\n    };\n\n    const renderReportSection = (title, fullReport, conciseReport, conciseText, showConcise, setShowConcise, type) => (\n        <Box mt={2} sx={{\n            border: `1px solid ${type === 'major_errors' ? 'darkred' : type === 'errors' ? 'red' : 'orange'}`,\n            padding: '10px',\n            borderRadius: '8px',\n            backgroundColor: type === 'major_errors' ? '#ffe6e6' : type === 'errors' ? '#ffe6e6' : '#fff4e6'\n        }}>\n            <Typography variant=\"h6\"\n                        sx={{color: type === 'major_errors' ? 'darkred' : type === 'errors' ? 'red' : 'orange'}}>{title}:</Typography>\n            {showConcise && (\n                <Box mt={2}>\n          <pre style={{whiteSpace: 'pre-wrap', wordWrap: 'break-word'}}>\n            {type === 'major_errors' ? majorInconsistencies :\n                type === 'errors' ? inconsistencies :\n                    type === 'warnings' ? warningInconsistencies : ''}\n          </pre>\n                </Box>\n            )}\n            <pre style={{\n                whiteSpace: 'pre-wrap',\n                wordWrap: 'break-word'\n            }}>{showConcise ? (conciseText ? conciseText : (conciseReport ? JSON.stringify(conciseReport, null, 2) : \"\")) : (fullReport ? JSON.stringify(fullReport, null, 2) : \"\")}</pre>\n            <Button variant=\"contained\" color=\"error\"\n                    onClick={() => handleDownloadReport(type)}>\n                Download {type.replace('_', ' ')} Report\n            </Button>\n            <Button variant=\"contained\" color=\"secondary\"\n                    onClick={() => setShowConcise(!showConcise)}>\n                {showConcise ? \"Show Full Report\" : \"Show Concise Report\"}\n            </Button>\n        </Box>\n    );\n\n    const copyToClipboard = () => {\n        navigator.clipboard.writeText(report)\n            .then(() => {\n                setCopySuccess('Report copied to clipboard!');\n                setTimeout(() => setCopySuccess(''), 2000);  // Clear the success message after 2 seconds\n            })\n            .catch(err => {\n                setCopySuccess('Failed to copy!');\n                console.error('Failed to copy: ', err);\n            });\n    };\n\n    return (\n        <Box\n            my={4}\n            sx={{\n                width: '80%',\n                margin: '0 auto',\n                padding: '20px',\n                border: '1px solid #ccc',\n                borderRadius: '8px',\n                backgroundColor: '#f9f9f9',\n                marginTop: '40px'\n            }}\n        >\n            <Typography variant=\"h4\" gutterBottom>\n                Select a BIDS Folder to Generate a Parameter Report\n            </Typography>\n\n            <Box mt={4} p={2}\n                 sx={{border: '1px solid #ccc', borderRadius: '8px', backgroundColor: '#f1f1f1'}}>\n                <Typography variant=\"h5\">User Manual</Typography>\n                <Typography variant=\"body1\" mt={2}>\n                    This application allows you to generate an ASL parameter report to be copied\n                    into the Methods section of paper. The program will validate the ASL datasets by\n                    checking for inconsistencies, invalid values, and providing warnings for slight\n                    variations. Please ensure that your dataset is organized according to the BIDS\n                    standard before uploading. Here are some sample folders for you to download and\n                    test:\n                    https://drive.google.com/drive/folders/1NuG_ofLbaLYswNlBN2aRDkxLOucYFQfg?usp=sharing\n                </Typography>\n                <Typography variant=\"body1\" mt={2}>\n                    <strong>Steps:</strong>\n                </Typography>\n                <Typography variant=\"body1\" mt={1}>\n                    1. Click the \"Choose Folder\" button and select the BIDS folder containing your\n                    ASL data.\n                </Typography>\n                <Typography variant=\"body1\" mt={1}>\n                    2. The application will process your files (including xxx_asl.json and\n                    xxx_asl.nii or\n                    xxx_asl.nii.gz) and display the results below.\n                </Typography>\n                <Typography variant=\"body1\" mt={1}>\n                    <strong>Note:</strong> The following specific checks and summaries will\n                    be reported:\n                </Typography>\n                <Typography variant=\"body2\" mt={1}>\n                    - <strong>Inconsistency Check:</strong> Discrepancies between values across\n                    different sessions, such as variations in PLD, labeling duration, echo time, and\n                    voxel sizes.\n                </Typography>\n                <Typography variant=\"body2\" mt={1}>\n                    - <strong>Invalid Values Check:</strong> Identifying values that do not meet\n                    predefined criteria, such as incorrect numeric ranges, boolean values, and\n                    string values.\n                </Typography>\n                <Typography variant=\"body2\" mt={1}>\n                    - <strong>Slight Variation Warning:</strong> Highlighting values that might not\n                    constitute a major error but are worth noting.\n                </Typography>\n                <Typography variant=\"body2\" mt={1}>\n                    - <strong>Generated Report:</strong> The software generates an ASL parameter\n                    report to be included in the Methods section of paper. A suggested statement for\n                    inclusion in the cover letter explaining that the relevant part of the Methods\n                    section has been constructed according to standard format is also provided\n                    (TODO).\n                </Typography>\n            </Box>\n\n            <input\n                type=\"file\"\n                webkitdirectory=\"true\"\n                onChange={handleDirectoryUpload}\n                style={{margin: '20px 0'}}\n            />\n            {uploadError && (\n                <Box mt={2} sx={{color: 'red'}}>\n                    <Typography variant=\"h6\">Upload Error:</Typography>\n                    <pre>{uploadError}</pre>\n                </Box>\n            )}\n            {majorErrorReport && renderReportSection(\n                \"MAJOR ERRORS (you cannot report a sequence protocol without these)\",\n                majorErrorReport,\n                majorErrorReportConcise,\n                majorErrorReportConciseText,\n                showMajorConcise,\n                setShowMajorConcise,\n                'major_errors'\n            )}\n            {errorReport && renderReportSection(\n                \"ERRORS (these are major shortcomings, you need to provide those)\",\n                errorReport,\n                errorReportConcise,\n                errorReportConciseText,\n                showErrorConcise,\n                setShowErrorConcise,\n                'errors'\n            )}\n            {warningReport && renderReportSection(\n                \"WARNINGS\",\n                warningReport,\n                warningReportConcise,\n                warningReportConciseText,\n                showWarningConcise,\n                setShowWarningConcise,\n                'warnings'\n            )}\n            {report && (\n                <Box mt={2} sx={{\n                    border: '1px solid blue',\n                    padding: '10px',\n                    borderRadius: '8px',\n                    backgroundColor: '#e6f7ff',\n                    maxHeight: '400px',\n                    overflowY: 'auto',\n                    position: 'relative'  // Add relative positioning for positioning the copy feedback\n                }}>\n                    <Typography variant=\"h6\" sx={{color: 'blue'}}>Generated Report:</Typography>\n                    <pre style={{whiteSpace: 'pre-wrap', wordWrap: 'break-word'}}>{report}</pre>\n                    <Button variant=\"contained\" color=\"primary\"\n                            onClick={() => handleDownloadReport('report')}>\n                        Download Report\n                    </Button>\n                    <Button variant=\"contained\" color=\"secondary\" onClick={copyToClipboard}\n                            sx={{ml: 2}}>\n                        Copy Report\n                    </Button>\n                    {copySuccess && (\n                        <Typography variant=\"subtitle1\" sx={{\n                            color: 'green',\n                            position: 'absolute',  // Position the feedback message absolutely\n                            top: 0,\n                            right: 0,\n                            mt: 1,\n                            mr: 1,\n                            backgroundColor: 'rgba(255, 255, 255, 0.8)',\n                            padding: '5px',\n                            borderRadius: '4px'\n                        }}>\n                            {copySuccess}\n                        </Typography>\n                    )}\n                </Box>\n            )}\n            {extendedReport && (\n                <Box mt={2} sx={{\n                    border: '1px solid green',\n                    padding: '10px',\n                    borderRadius: '8px',\n                    backgroundColor: '#e6ffe6',\n                    maxHeight: '400px',\n                    overflowY: 'auto',\n                    position: 'relative'  // Add relative positioning for positioning the copy feedback\n                }}>\n                    <Typography variant=\"h6\" sx={{color: 'green'}}>Extended Report:</Typography>\n                    <pre style={{\n                        whiteSpace: 'pre-wrap',\n                        wordWrap: 'break-word'\n                    }}>{extendedReport}</pre>\n                    <Button variant=\"contained\" color=\"primary\"\n                            onClick={() => handleDownloadReport('extended_report')}>\n                        Download Extended Report\n                    </Button>\n                </Box>\n            )}\n        </Box>\n    );\n}\n\nexport default JSONUpload;"],"mappings":";;AAAA,OAAOA,KAAK,IAAGC,QAAQ,QAAO,OAAO;AACrC,SAAQC,GAAG,EAAEC,MAAM,EAAEC,UAAU,QAAO,eAAe;;AAErD;AAAA,SAAAC,MAAA,IAAAC,OAAA;AACA,MAAMC,YAAY,GAAG,uBAAuB;;AAE5C;;AAEA,SAASC,UAAUA,CAAA,EAAG;EAAAC,EAAA;EAClB,MAAM,CAACC,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGV,QAAQ,CAAC,IAAI,CAAC;EAC9D,MAAM,CAACW,uBAAuB,EAAEC,0BAA0B,CAAC,GAAGZ,QAAQ,CAAC,IAAI,CAAC;EAC5E,MAAM,CAACa,2BAA2B,EAAEC,8BAA8B,CAAC,GAAGd,QAAQ,CAAC,IAAI,CAAC;EACpF,MAAM,CAACe,WAAW,EAAEC,cAAc,CAAC,GAAGhB,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAM,CAACiB,kBAAkB,EAAEC,qBAAqB,CAAC,GAAGlB,QAAQ,CAAC,IAAI,CAAC;EAClE,MAAM,CAACmB,sBAAsB,EAAEC,yBAAyB,CAAC,GAAGpB,QAAQ,CAAC,IAAI,CAAC;EAC1E,MAAM,CAACqB,aAAa,EAAEC,gBAAgB,CAAC,GAAGtB,QAAQ,CAAC,IAAI,CAAC;EACxD,MAAM,CAACuB,oBAAoB,EAAEC,uBAAuB,CAAC,GAAGxB,QAAQ,CAAC,IAAI,CAAC;EACtE,MAAM,CAACyB,wBAAwB,EAAEC,2BAA2B,CAAC,GAAG1B,QAAQ,CAAC,IAAI,CAAC;EAC9E,MAAM,CAAC2B,MAAM,EAAEC,SAAS,CAAC,GAAG5B,QAAQ,CAAC,IAAI,CAAC;EAC1C,MAAM,CAAC6B,cAAc,EAAEC,iBAAiB,CAAC,GAAG9B,QAAQ,CAAC,IAAI,CAAC;EAC1D,MAAM,CAAC+B,WAAW,EAAEC,cAAc,CAAC,GAAGhC,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAM,CAACiC,eAAe,EAAEC,kBAAkB,CAAC,GAAGlC,QAAQ,CAAC,IAAI,CAAC;EAC5D,MAAM,CAACmC,oBAAoB,EAAEC,uBAAuB,CAAC,GAAGpC,QAAQ,CAAC,IAAI,CAAC;EACtE,MAAM,CAACqC,sBAAsB,EAAEC,yBAAyB,CAAC,GAAGtC,QAAQ,CAAC,IAAI,CAAC;EAE1E,MAAM,CAACuC,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGxC,QAAQ,CAAC,IAAI,CAAC;EAC9D,MAAM,CAACyC,gBAAgB,EAAEC,mBAAmB,CAAC,GAAG1C,QAAQ,CAAC,IAAI,CAAC;EAC9D,MAAM,CAAC2C,kBAAkB,EAAEC,qBAAqB,CAAC,GAAG5C,QAAQ,CAAC,IAAI,CAAC;EAClE,MAAM,CAAC6C,WAAW,EAAEC,cAAc,CAAC,GAAG9C,QAAQ,CAAC,EAAE,CAAC;EAGlD,MAAM+C,qBAAqB,GAAG,MAAOC,KAAK,IAAK;IAC3C,MAAMC,KAAK,GAAGC,KAAK,CAACC,IAAI,CAACH,KAAK,CAACI,MAAM,CAACH,KAAK,CAAC;;IAG5C;IACA,MAAMI,iBAAiB,GAAIC,KAAK,IAAK;MACjC,MAAMC,aAAa,GAAG,EAAE;;MAExB;MACA,MAAMC,gBAAgB,GAAGA,CAACC,WAAW,EAAEC,QAAQ,KAAK;QAChD,OAAOD,WAAW,CAACE,IAAI,CAACC,IAAI,IAAIA,IAAI,CAACC,IAAI,CAACC,QAAQ,CAACJ,QAAQ,CAAC,CAAC;MACjE,CAAC;MAED,KAAK,MAAME,IAAI,IAAIN,KAAK,EAAE;QACtB,MAAMS,YAAY,GAAGH,IAAI,CAACI,kBAAkB,IAAIJ,IAAI,CAACG,YAAY;QACjE,MAAME,SAAS,GAAGF,YAAY,CAACG,KAAK,CAAC,GAAG,CAAC;QACzC,MAAMC,YAAY,GAAGF,SAAS,CAACA,SAAS,CAACG,MAAM,GAAG,CAAC,CAAC;QAEpD,IAAID,YAAY,KAAK,MAAM,IAAIP,IAAI,CAACC,IAAI,CAACC,QAAQ,CAAC,UAAU,CAAC,EAAE;UAC3DP,aAAa,CAACc,IAAI,CAACT,IAAI,CAAC;UACxB;UACA,MAAMU,QAAQ,GAAGV,IAAI,CAACC,IAAI,CAACU,OAAO,CAAC,WAAW,EAAE,EAAE,CAAC;;UAEnD;UACA,MAAMd,WAAW,GAAGH,KAAK,CAACkB,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACT,kBAAkB,CAACU,UAAU,CAACX,YAAY,CAACQ,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,CAAC;;UAE1G;UACA,MAAMI,eAAe,GAAGL,QAAQ,CAACM,KAAK,CAAC,WAAW,CAAC;UAEnD,IAAID,eAAe,EAAE;YACjB,MAAME,UAAU,GAAGrB,gBAAgB,CAACC,WAAW,EAAE,GAAGa,QAAQ,cAAc,CAAC;YAC3E,MAAMQ,cAAc,GAAGtB,gBAAgB,CAACC,WAAW,EAAE,GAAGa,QAAQ,iBAAiB,CAAC;YAElF,IAAIO,UAAU,EAAE;cACZtB,aAAa,CAACc,IAAI,CAACQ,UAAU,CAAC,CAAC,CAAC;YACpC;YACA,IAAIC,cAAc,EAAE;cAChBvB,aAAa,CAACc,IAAI,CAACS,cAAc,CAAC,CAAC,CAAC;YACxC;UAEJ,CAAC,MAAM;YACH,MAAMD,UAAU,GAAGrB,gBAAgB,CAACC,WAAW,EAAE,aAAa,CAAC;YAC/D,MAAMqB,cAAc,GAAGtB,gBAAgB,CAACC,WAAW,EAAE,gBAAgB,CAAC;YAEtE,IAAIoB,UAAU,EAAE;cACZtB,aAAa,CAACc,IAAI,CAACQ,UAAU,CAAC,CAAC,CAAC;YACpC;YACA,IAAIC,cAAc,EAAE;cAChBvB,aAAa,CAACc,IAAI,CAACS,cAAc,CAAC,CAAC,CAAC;YACxC;UACJ;QACJ;MACJ;MAEA,OAAOvB,aAAa;IACxB,CAAC;;IAED;IACA,MAAMwB,WAAW,GAAIzB,KAAK,IAAK;MAC3B,KAAK,MAAMM,IAAI,IAAIN,KAAK,EAAE;QACtB,MAAMS,YAAY,GAAGH,IAAI,CAACI,kBAAkB,IAAIJ,IAAI,CAACG,YAAY;QACjE,MAAME,SAAS,GAAGF,YAAY,CAACG,KAAK,CAAC,GAAG,CAAC;QACzC,MAAMC,YAAY,GAAGF,SAAS,CAACA,SAAS,CAACG,MAAM,GAAG,CAAC,CAAC;QAEpD,IAAID,YAAY,KAAK,MAAM,KACtBP,IAAI,CAACC,IAAI,CAACC,QAAQ,CAAC,YAAY,CAAC,IAAIF,IAAI,CAACC,IAAI,CAACC,QAAQ,CAAC,SAAS,CAAC,CAAC,EAAE;UACrE,OAAOF,IAAI,CAAC,CAAC;QACjB;MACJ;MACA,OAAO,IAAI;IACf,CAAC;;IAED;IACA,MAAMoB,OAAO,GAAGD,WAAW,CAAC9B,KAAK,CAAC;IAElC,MAAMM,aAAa,GAAGF,iBAAiB,CAACJ,KAAK,CAAC;IAC9C,MAAMgC,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;IAC/BD,QAAQ,CAACE,MAAM,CAAC,UAAU,EAAEH,OAAO,CAAC;;IAEpC;IACA/B,KAAK,CAACmC,OAAO,CAACC,IAAI,IAAI;MAClB,IAAIA,IAAI,CAACxB,IAAI,CAACC,QAAQ,CAAC,MAAM,CAAC,EAAE;QAC5BmB,QAAQ,CAACE,MAAM,CAAC,WAAW,EAAEE,IAAI,CAAC;MACtC;IACJ,CAAC,CAAC;IAEF9B,aAAa,CAAC6B,OAAO,CAACC,IAAI,IAAI;MAC1BJ,QAAQ,CAACE,MAAM,CAAC,OAAO,EAAEE,IAAI,CAAC;MAC9BJ,QAAQ,CAACE,MAAM,CAAC,WAAW,EAAEE,IAAI,CAACxB,IAAI,CAAC;IAC3C,CAAC,CAAC;IAGF,IAAI;MACA,MAAMyB,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGjF,YAAY,SAAS,EAAE;QACnDkF,MAAM,EAAE,MAAM;QACdC,IAAI,EAAER;MACV,CAAC,CAAC;MAEF,IAAI,CAACK,QAAQ,CAACI,EAAE,EAAE;QACd,MAAMC,SAAS,GAAG,MAAML,QAAQ,CAACM,IAAI,CAAC,CAAC;QACvC,MAAM,IAAIC,KAAK,CAAC,iBAAiBP,QAAQ,CAACQ,MAAM,MAAMH,SAAS,EAAE,CAAC;MACtE;MAEA,MAAMI,MAAM,GAAG,MAAMT,QAAQ,CAACU,IAAI,CAAC,CAAC;MACpCtF,mBAAmB,CAACuF,MAAM,CAACC,IAAI,CAACH,MAAM,CAACI,YAAY,CAAC,CAAC/B,MAAM,GAAG2B,MAAM,CAACI,YAAY,GAAG,IAAI,CAAC;MACzFvF,0BAA0B,CAACqF,MAAM,CAACC,IAAI,CAACH,MAAM,CAACK,oBAAoB,CAAC,CAAChC,MAAM,GAAG2B,MAAM,CAACK,oBAAoB,GAAG,IAAI,CAAC;MAChHtF,8BAA8B,CAACiF,MAAM,CAACM,yBAAyB,IAAI,IAAI,CAAC;MACxErF,cAAc,CAACiF,MAAM,CAACC,IAAI,CAACH,MAAM,CAACO,MAAM,CAAC,CAAClC,MAAM,GAAG2B,MAAM,CAACO,MAAM,GAAG,IAAI,CAAC;MACxEpF,qBAAqB,CAAC+E,MAAM,CAACC,IAAI,CAACH,MAAM,CAACQ,cAAc,CAAC,CAACnC,MAAM,GAAG2B,MAAM,CAACQ,cAAc,GAAG,IAAI,CAAC;MAC/FnF,yBAAyB,CAAC2E,MAAM,CAACS,mBAAmB,IAAI,IAAI,CAAC;MAC7DlF,gBAAgB,CAAC2E,MAAM,CAACC,IAAI,CAACH,MAAM,CAACU,QAAQ,CAAC,CAACrC,MAAM,GAAG2B,MAAM,CAACU,QAAQ,GAAG,IAAI,CAAC;MAC9EjF,uBAAuB,CAACyE,MAAM,CAACC,IAAI,CAACH,MAAM,CAACW,gBAAgB,CAAC,CAACtC,MAAM,GAAG2B,MAAM,CAACW,gBAAgB,GAAG,IAAI,CAAC;MACrGhF,2BAA2B,CAACqE,MAAM,CAACY,qBAAqB,IAAI,IAAI,CAAC;MACjE/E,SAAS,CAACmE,MAAM,CAACpE,MAAM,IAAI,IAAI,CAAC;MAChCO,kBAAkB,CAAC6D,MAAM,CAAC9D,eAAe,IAAI,IAAI,CAAC;MAClDG,uBAAuB,CAAC2D,MAAM,CAACa,qBAAqB,IAAI,IAAI,CAAC;MAC7DtE,yBAAyB,CAACyD,MAAM,CAACc,uBAAuB,IAAI,IAAI,CAAC;MACjE7E,cAAc,CAAC,IAAI,CAAC;IACxB,CAAC,CAAC,OAAO8E,KAAK,EAAE;MACZC,OAAO,CAACD,KAAK,CAAC,QAAQ,EAAEA,KAAK,CAAC;MAC9B9E,cAAc,CAAC8E,KAAK,CAACE,OAAO,CAAC;IACjC;EACJ,CAAC;EAED,MAAMC,oBAAoB,GAAIC,IAAI,IAAK;IACnCC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,GAAG/G,YAAY,kBAAkB4G,IAAI,EAAE;EAClE,CAAC;EAED,MAAMI,mBAAmB,GAAGA,CAACC,KAAK,EAAEC,UAAU,EAAEC,aAAa,EAAEC,WAAW,EAAEC,WAAW,EAAEC,cAAc,EAAEV,IAAI,kBACzG7G,OAAA,CAACJ,GAAG;IAAC4H,EAAE,EAAE,CAAE;IAACC,EAAE,EAAE;MACZC,MAAM,EAAE,aAAab,IAAI,KAAK,cAAc,GAAG,SAAS,GAAGA,IAAI,KAAK,QAAQ,GAAG,KAAK,GAAG,QAAQ,EAAE;MACjGc,OAAO,EAAE,MAAM;MACfC,YAAY,EAAE,KAAK;MACnBC,eAAe,EAAEhB,IAAI,KAAK,cAAc,GAAG,SAAS,GAAGA,IAAI,KAAK,QAAQ,GAAG,SAAS,GAAG;IAC3F,CAAE;IAAAiB,QAAA,gBACE9H,OAAA,CAACF,UAAU;MAACiI,OAAO,EAAC,IAAI;MACZN,EAAE,EAAE;QAACO,KAAK,EAAEnB,IAAI,KAAK,cAAc,GAAG,SAAS,GAAGA,IAAI,KAAK,QAAQ,GAAG,KAAK,GAAG;MAAQ,CAAE;MAAAiB,QAAA,GAAEZ,KAAK,EAAC,GAAC;IAAA;MAAA7D,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAY,CAAC,EACzHb,WAAW,iBACRtH,OAAA,CAACJ,GAAG;MAAC4H,EAAE,EAAE,CAAE;MAAAM,QAAA,eACjB9H,OAAA;QAAKoI,KAAK,EAAE;UAACC,UAAU,EAAE,UAAU;UAAEC,QAAQ,EAAE;QAAY,CAAE;QAAAR,QAAA,EAC1DjB,IAAI,KAAK,cAAc,GAAG/E,oBAAoB,GAC3C+E,IAAI,KAAK,QAAQ,GAAGjF,eAAe,GAC/BiF,IAAI,KAAK,UAAU,GAAG7E,sBAAsB,GAAG;MAAE;QAAAqB,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACtD;IAAC;MAAA9E,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACK,CACR,eACDnI,OAAA;MAAKoI,KAAK,EAAE;QACRC,UAAU,EAAE,UAAU;QACtBC,QAAQ,EAAE;MACd,CAAE;MAAAR,QAAA,EAAER,WAAW,GAAID,WAAW,GAAGA,WAAW,GAAID,aAAa,GAAGmB,IAAI,CAACC,SAAS,CAACpB,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC,GAAG,EAAG,GAAKD,UAAU,GAAGoB,IAAI,CAACC,SAAS,CAACrB,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC,GAAG;IAAG;MAAA9D,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAM,CAAC,eAC9KnI,OAAA,CAACH,MAAM;MAACkI,OAAO,EAAC,WAAW;MAACC,KAAK,EAAC,OAAO;MACjCS,OAAO,EAAEA,CAAA,KAAM7B,oBAAoB,CAACC,IAAI,CAAE;MAAAiB,QAAA,GAAC,WACtC,EAACjB,IAAI,CAAC3C,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,EAAC,SACrC;IAAA;MAAAb,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAQ,CAAC,eACTnI,OAAA,CAACH,MAAM;MAACkI,OAAO,EAAC,WAAW;MAACC,KAAK,EAAC,WAAW;MACrCS,OAAO,EAAEA,CAAA,KAAMlB,cAAc,CAAC,CAACD,WAAW,CAAE;MAAAQ,QAAA,EAC/CR,WAAW,GAAG,kBAAkB,GAAG;IAAqB;MAAAjE,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACrD,CAAC;EAAA;IAAA9E,QAAA,EAAA4E,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACR,CACR;EAED,MAAMO,eAAe,GAAGA,CAAA,KAAM;IAC1BC,SAAS,CAACC,SAAS,CAACC,SAAS,CAACvH,MAAM,CAAC,CAChCwH,IAAI,CAAC,MAAM;MACRrG,cAAc,CAAC,6BAA6B,CAAC;MAC7CsG,UAAU,CAAC,MAAMtG,cAAc,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC,CAAE;IACjD,CAAC,CAAC,CACDuG,KAAK,CAACC,GAAG,IAAI;MACVxG,cAAc,CAAC,iBAAiB,CAAC;MACjCiE,OAAO,CAACD,KAAK,CAAC,kBAAkB,EAAEwC,GAAG,CAAC;IAC1C,CAAC,CAAC;EACV,CAAC;EAED,oBACIjJ,OAAA,CAACJ,GAAG;IACAsJ,EAAE,EAAE,CAAE;IACNzB,EAAE,EAAE;MACA0B,KAAK,EAAE,KAAK;MACZC,MAAM,EAAE,QAAQ;MAChBzB,OAAO,EAAE,MAAM;MACfD,MAAM,EAAE,gBAAgB;MACxBE,YAAY,EAAE,KAAK;MACnBC,eAAe,EAAE,SAAS;MAC1BwB,SAAS,EAAE;IACf,CAAE;IAAAvB,QAAA,gBAEF9H,OAAA,CAACF,UAAU;MAACiI,OAAO,EAAC,IAAI;MAACuB,YAAY;MAAAxB,QAAA,EAAC;IAEtC;MAAAzE,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAY,CAAC,eAEbnI,OAAA,CAACJ,GAAG;MAAC4H,EAAE,EAAE,CAAE;MAAC+B,CAAC,EAAE,CAAE;MACZ9B,EAAE,EAAE;QAACC,MAAM,EAAE,gBAAgB;QAAEE,YAAY,EAAE,KAAK;QAAEC,eAAe,EAAE;MAAS,CAAE;MAAAC,QAAA,gBACjF9H,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,IAAI;QAAAD,QAAA,EAAC;MAAW;QAAAzE,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eACjDnI,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,OAAO;QAACP,EAAE,EAAE,CAAE;QAAAM,QAAA,EAAC;MAQnC;QAAAzE,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eACbnI,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,OAAO;QAACP,EAAE,EAAE,CAAE;QAAAM,QAAA,eAC9B9H,OAAA;UAAA8H,QAAA,EAAQ;QAAM;UAAAzE,QAAA,EAAA4E,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ;MAAC;QAAA9E,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACf,CAAC,eACbnI,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,OAAO;QAACP,EAAE,EAAE,CAAE;QAAAM,QAAA,EAAC;MAGnC;QAAAzE,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eACbnI,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,OAAO;QAACP,EAAE,EAAE,CAAE;QAAAM,QAAA,EAAC;MAInC;QAAAzE,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eACbnI,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,OAAO;QAACP,EAAE,EAAE,CAAE;QAAAM,QAAA,gBAC9B9H,OAAA;UAAA8H,QAAA,EAAQ;QAAK;UAAAzE,QAAA,EAAA4E,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,kEAE1B;MAAA;QAAA9E,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eACbnI,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,OAAO;QAACP,EAAE,EAAE,CAAE;QAAAM,QAAA,GAAC,IAC7B,eAAA9H,OAAA;UAAA8H,QAAA,EAAQ;QAAoB;UAAAzE,QAAA,EAAA4E,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,sIAG3C;MAAA;QAAA9E,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eACbnI,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,OAAO;QAACP,EAAE,EAAE,CAAE;QAAAM,QAAA,GAAC,IAC7B,eAAA9H,OAAA;UAAA8H,QAAA,EAAQ;QAAqB;UAAAzE,QAAA,EAAA4E,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,kIAG5C;MAAA;QAAA9E,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eACbnI,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,OAAO;QAACP,EAAE,EAAE,CAAE;QAAAM,QAAA,GAAC,IAC7B,eAAA9H,OAAA;UAAA8H,QAAA,EAAQ;QAAyB;UAAAzE,QAAA,EAAA4E,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,sFAEhD;MAAA;QAAA9E,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eACbnI,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,OAAO;QAACP,EAAE,EAAE,CAAE;QAAAM,QAAA,GAAC,IAC7B,eAAA9H,OAAA;UAAA8H,QAAA,EAAQ;QAAiB;UAAAzE,QAAA,EAAA4E,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,+RAKxC;MAAA;QAAA9E,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC;IAAA;MAAA9E,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACZ,CAAC,eAENnI,OAAA;MACI6G,IAAI,EAAC,MAAM;MACX2C,eAAe,EAAC,MAAM;MACtBC,QAAQ,EAAE/G,qBAAsB;MAChC0F,KAAK,EAAE;QAACgB,MAAM,EAAE;MAAQ;IAAE;MAAA/F,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC7B,CAAC,EACDzG,WAAW,iBACR1B,OAAA,CAACJ,GAAG;MAAC4H,EAAE,EAAE,CAAE;MAACC,EAAE,EAAE;QAACO,KAAK,EAAE;MAAK,CAAE;MAAAF,QAAA,gBAC3B9H,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,IAAI;QAAAD,QAAA,EAAC;MAAa;QAAAzE,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eACnDnI,OAAA;QAAA8H,QAAA,EAAMpG;MAAW;QAAA2B,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAM,CAAC;IAAA;MAAA9E,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACvB,CACR,EACA/H,gBAAgB,IAAI6G,mBAAmB,CACpC,oEAAoE,EACpE7G,gBAAgB,EAChBE,uBAAuB,EACvBE,2BAA2B,EAC3B0B,gBAAgB,EAChBC,mBAAmB,EACnB,cACJ,CAAC,EACAzB,WAAW,IAAIuG,mBAAmB,CAC/B,kEAAkE,EAClEvG,WAAW,EACXE,kBAAkB,EAClBE,sBAAsB,EACtBsB,gBAAgB,EAChBC,mBAAmB,EACnB,QACJ,CAAC,EACArB,aAAa,IAAIiG,mBAAmB,CACjC,UAAU,EACVjG,aAAa,EACbE,oBAAoB,EACpBE,wBAAwB,EACxBkB,kBAAkB,EAClBC,qBAAqB,EACrB,UACJ,CAAC,EACAjB,MAAM,iBACHtB,OAAA,CAACJ,GAAG;MAAC4H,EAAE,EAAE,CAAE;MAACC,EAAE,EAAE;QACZC,MAAM,EAAE,gBAAgB;QACxBC,OAAO,EAAE,MAAM;QACfC,YAAY,EAAE,KAAK;QACnBC,eAAe,EAAE,SAAS;QAC1B6B,SAAS,EAAE,OAAO;QAClBC,SAAS,EAAE,MAAM;QACjBC,QAAQ,EAAE,UAAU,CAAE;MAC1B,CAAE;MAAA9B,QAAA,gBACE9H,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,IAAI;QAACN,EAAE,EAAE;UAACO,KAAK,EAAE;QAAM,CAAE;QAAAF,QAAA,EAAC;MAAiB;QAAAzE,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eAC5EnI,OAAA;QAAKoI,KAAK,EAAE;UAACC,UAAU,EAAE,UAAU;UAAEC,QAAQ,EAAE;QAAY,CAAE;QAAAR,QAAA,EAAExG;MAAM;QAAA+B,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAM,CAAC,eAC5EnI,OAAA,CAACH,MAAM;QAACkI,OAAO,EAAC,WAAW;QAACC,KAAK,EAAC,SAAS;QACnCS,OAAO,EAAEA,CAAA,KAAM7B,oBAAoB,CAAC,QAAQ,CAAE;QAAAkB,QAAA,EAAC;MAEvD;QAAAzE,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,eACTnI,OAAA,CAACH,MAAM;QAACkI,OAAO,EAAC,WAAW;QAACC,KAAK,EAAC,WAAW;QAACS,OAAO,EAAEC,eAAgB;QAC/DjB,EAAE,EAAE;UAACoC,EAAE,EAAE;QAAC,CAAE;QAAA/B,QAAA,EAAC;MAErB;QAAAzE,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,EACR3F,WAAW,iBACRxC,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,WAAW;QAACN,EAAE,EAAE;UAChCO,KAAK,EAAE,OAAO;UACd4B,QAAQ,EAAE,UAAU;UAAG;UACvBE,GAAG,EAAE,CAAC;UACNC,KAAK,EAAE,CAAC;UACRvC,EAAE,EAAE,CAAC;UACLwC,EAAE,EAAE,CAAC;UACLnC,eAAe,EAAE,0BAA0B;UAC3CF,OAAO,EAAE,KAAK;UACdC,YAAY,EAAE;QAClB,CAAE;QAAAE,QAAA,EACGtF;MAAW;QAAAa,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACJ,CACf;IAAA;MAAA9E,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACA,CACR,EACA3G,cAAc,iBACXxB,OAAA,CAACJ,GAAG;MAAC4H,EAAE,EAAE,CAAE;MAACC,EAAE,EAAE;QACZC,MAAM,EAAE,iBAAiB;QACzBC,OAAO,EAAE,MAAM;QACfC,YAAY,EAAE,KAAK;QACnBC,eAAe,EAAE,SAAS;QAC1B6B,SAAS,EAAE,OAAO;QAClBC,SAAS,EAAE,MAAM;QACjBC,QAAQ,EAAE,UAAU,CAAE;MAC1B,CAAE;MAAA9B,QAAA,gBACE9H,OAAA,CAACF,UAAU;QAACiI,OAAO,EAAC,IAAI;QAACN,EAAE,EAAE;UAACO,KAAK,EAAE;QAAO,CAAE;QAAAF,QAAA,EAAC;MAAgB;QAAAzE,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC,eAC5EnI,OAAA;QAAKoI,KAAK,EAAE;UACRC,UAAU,EAAE,UAAU;UACtBC,QAAQ,EAAE;QACd,CAAE;QAAAR,QAAA,EAAEtG;MAAc;QAAA6B,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAM,CAAC,eACzBnI,OAAA,CAACH,MAAM;QAACkI,OAAO,EAAC,WAAW;QAACC,KAAK,EAAC,SAAS;QACnCS,OAAO,EAAEA,CAAA,KAAM7B,oBAAoB,CAAC,iBAAiB,CAAE;QAAAkB,QAAA,EAAC;MAEhE;QAAAzE,QAAA,EAAA4E,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAA9E,QAAA,EAAA4E,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACR,CACR;EAAA;IAAA9E,QAAA,EAAA4E,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACA,CAAC;AAEd;AAAChI,EAAA,CA3WQD,UAAU;AAAA+J,EAAA,GAAV/J,UAAU;AA6WnB,eAAeA,UAAU;AAAC,IAAA+J,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}